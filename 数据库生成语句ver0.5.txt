CREATE USER IF NOT EXISTS 'choco'@'localhost' IDENTIFIED BY 'choco';

GRANT ALL PRIVILEGES ON *.* TO 'choco'@'localhost';

FLUSH PRIVILEGES;

CREATE DATABASE IF NOT EXISTS `ithink`;

USE `ithink`;

CREATE TABLE IF NOT EXISTS `user_info` (
  `user_id` int(10) NOT NULL AUTO_INCREMENT,
  `user_name` varchar(20) NOT NULL COMMENT '用户名称',
  `user_password` varchar(20) NOT NULL COMMENT '用户密码',
  `user_sex` varchar(5) NOT NULL COMMENT '用户性别',
  `user_email` varchar(20) NOT NULL COMMENT '用户邮箱',
  `user_birth` varchar(20) NOT NULL COMMENT '用户生日',
  `user_phone` varchar(20) NOT NULL COMMENT '用户手机号',
  `user_credit` int(4) NOT NULL COMMENT '用户信誉积分',
  `user_avatar` blob NOT NULL COMMENT '用户头像，会有默认头像',
  PRIMARY KEY (`user_id`) USING BTREE,
  UNIQUE KEY `user_email` (`user_email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


CREATE TABLE IF NOT EXISTS `creative_capsule` (
  `creative_id` int(10) NOT NULL AUTO_INCREMENT COMMENT '创意胶囊id',
  `creative_name` varchar(20) NOT NULL COMMENT '创意胶囊名字',
  `user_id` int(10) NOT NULL COMMENT '创意胶囊拥有者用户名id',
  `creative_content` varchar(255) NOT NULL COMMENT '创意胶囊内容',
  `creative_buildTime` datetime NOT NULL COMMENT '创意胶囊生成时间',
  `creative_uploadTime` datetime NOT NULL COMMENT '创意胶囊发布（生成帖子）时间',
  PRIMARY KEY (`creative_id`),
  KEY `user_id_idx` (`user_id`),
  CONSTRAINT `userId_creativeCapsule` FOREIGN KEY (`user_id`) REFERENCES `user_info` (`user_id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;

CREATE TABLE IF NOT EXISTS `bbs_topic` (
  `topic_id` int(10) NOT NULL AUTO_INCREMENT COMMENT '创意主题id（类似知乎问题）',
  `topic_publisher` int(10) NOT NULL COMMENT '主题发布人  外键：user_id',
  `topic_title` varchar(25) NOT NULL COMMENT '创意主题名称（帖子名称）',
  `topic_creativeCapsule` int(10) NOT NULL COMMENT '相对应的创意胶囊的id（外键）',
  `topic_content` varchar(255) NOT NULL COMMENT '创意主题内容（发布人额外的描述）',
  `topic_Releasetime` datetime NOT NULL COMMENT '创意主题发布（生成）的时间',
  `topic_achievementNum` int(10) NOT NULL COMMENT '创意实现想法数量',
  `topic_collectionNum` int(10) NOT NULL COMMENT '创意主题收藏数',
  PRIMARY KEY (`topic_id`) USING BTREE,
  KEY `topic_publisher_idx` (`topic_publisher`),
  CONSTRAINT `topicPublisher_bbsTopic` FOREIGN KEY (`topic_publisher`) REFERENCES `user_info` (`user_id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;

CREATE TABLE IF NOT EXISTS `bbs_achievement` (
  `achievement_id` int(10) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `topic_id` int(10) NOT NULL COMMENT '用于记录挂载在那个创意主题下',
  `achievement_content` varchar(255) NOT NULL COMMENT '创意实现想法内容',
  `user_id` int(10) NOT NULL COMMENT '发布创意实现用户的id',
  `achievement_likeNum` int(10) NOT NULL COMMENT '实现想法点赞数',
  `achievement_unlikeNum` int(10) NOT NULL COMMENT '实现想法点踩数',
  `achievement_bulidTime` datetime NOT NULL COMMENT '创意实现提出时间',
  `achievement_commentNum` int(10) NOT NULL COMMENT '评论数',
  PRIMARY KEY (`achievement_id`) USING BTREE,
  KEY `topic_id_idx` (`topic_id`),
  KEY `user_id_idx` (`user_id`),
  CONSTRAINT `topicId_bbsAchievement` FOREIGN KEY (`topic_id`) REFERENCES `bbs_topic` (`topic_id`),
  CONSTRAINT `userId_bbsAchievement` FOREIGN KEY (`user_id`) REFERENCES `user_info` (`user_id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;

CREATE TABLE IF NOT EXISTS `bbs_comment` (
  `comment_id` int(10) NOT NULL AUTO_INCREMENT COMMENT '针对实现想法的评论的id',
  `achievement_id` int(10) NOT NULL COMMENT '挂载到对应创意实现下面',
  `comment_content` varchar(255) NOT NULL COMMENT '评论内容',
  `comment_buildTime` datetime NOT NULL COMMENT '评论时间',
  `comment_likeNum` int(10) NOT NULL COMMENT '评论点赞数',
  `comment_replyNum` int(10) NOT NULL COMMENT '评论回复数',
  `from_uid` int(10) NOT NULL COMMENT '评论用户id',
  `to_uid` int(10) NOT NULL COMMENT '被评论的创意实现的提出者的id',
  PRIMARY KEY (`comment_id`),
  KEY `acheievementId_bbsComment_idx` (`achievement_id`),
  KEY `fromUid_bbsComment_idx` (`from_uid`),
  KEY `toUid_bbsComment_idx` (`to_uid`),
  CONSTRAINT `acheievementId_bbsComment` FOREIGN KEY (`achievement_id`) REFERENCES `bbs_achievement` (`achievement_id`),
  CONSTRAINT `fromUid_bbsComment` FOREIGN KEY (`from_uid`) REFERENCES `user_info` (`user_id`),
  CONSTRAINT `toUid_bbsComment` FOREIGN KEY (`to_uid`) REFERENCES `user_info` (`user_id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;

CREATE TABLE IF NOT EXISTS `bbs_reply` (
  `reply_id` int(10) NOT NULL AUTO_INCREMENT COMMENT '对创意实现下的评论的回复',
  `comment_id` int(10) NOT NULL COMMENT '用于记录挂载在那个评论下',
  `reply_content` varchar(255) NOT NULL COMMENT '回复内容',
  `reply_likeNum` int(10) NOT NULL COMMENT '回复点赞数',
  `from_uid` int(10) NOT NULL COMMENT '发布回复的用户id',
  `to_uid` int(10) NOT NULL COMMENT '被回复的评论的用户id',
  PRIMARY KEY (`reply_id`),
  KEY `commentId_bbsReply_idx` (`comment_id`),
  KEY `fromUid_bbsReply_idx` (`from_uid`),
  KEY `toUid_bbsReply_idx` (`to_uid`),
  CONSTRAINT `commentId_bbsReply` FOREIGN KEY (`comment_id`) REFERENCES `bbs_comment` (`comment_id`),
  CONSTRAINT `fromUid_bbsReply` FOREIGN KEY (`from_uid`) REFERENCES `user_info` (`user_id`),
  CONSTRAINT `toUid_bbsReply` FOREIGN KEY (`to_uid`) REFERENCES `user_info` (`user_id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;

CREATE TABLE `bbs_group` (
  `group_id` int(10) NOT NULL COMMENT '团组id',
  `topic_id` int(10) NOT NULL COMMENT '团组所属的创意主题（外键）',
  `group_name` varchar(20) NOT NULL COMMENT '团组名称',
  `group_buildTime` datetime NOT NULL COMMENT '团组建立时间',
  `group_ownerID` int(10) NOT NULL COMMENT '团组建立者id（外键）',
  `group_number` int(10) NOT NULL COMMENT '团组中人数（包含建立者）',
  PRIMARY KEY (`group_id`),
  KEY `topic_id` (`topic_id`),
  KEY `group_ownerID` (`group_ownerID`),
  CONSTRAINT `bbs_group_ibfk_1` FOREIGN KEY (`topic_id`) REFERENCES `bbs_topic` (`topic_id`),
  CONSTRAINT `bbs_group_ibfk_2` FOREIGN KEY (`group_ownerID`) REFERENCES `user_info` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `group_namelist` (
  `id` int(10) NOT NULL,
  `group_id` int(10) NOT NULL COMMENT '挂靠在一个具体团组下',
  `user_id` int(10) NOT NULL COMMENT '一个团组中具体的人',
  PRIMARY KEY (`id`),
  KEY `group_id` (`group_id`),
  KEY `user_id` (`user_id`),
  CONSTRAINT `group_namelist_ibfk_1` FOREIGN KEY (`group_id`) REFERENCES `bbs_group` (`group_id`),
  CONSTRAINT `group_namelist_ibfk_2` FOREIGN KEY (`user_id`) REFERENCES `user_info` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


CREATE TABLE `user_creativeinfo` (
  `id` int(10) NOT NULL,
  `user_id` int(10) NOT NULL COMMENT '关联对应用户',
  `user_capsuleNum` int(10) NOT NULL COMMENT '用户拥有创意胶囊数',
  `user_creativeTopicNum` int(10) NOT NULL COMMENT '用户创意发布数',
  `user_followNum` int(10) NOT NULL COMMENT '用户关注数',
  `user_fansNum` int(10) NOT NULL COMMENT '用户被关注数',
  PRIMARY KEY (`id`),
  KEY `user_id` (`user_id`),
  CONSTRAINT `user_creativeinfo_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `user_info` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `followers_namelist` (
  `follow_id` int(10) NOT NULL,
  `user_id` int(10) NOT NULL COMMENT '外键',
  PRIMARY KEY (`follow_id`),
  KEY `user_id` (`user_id`),
  CONSTRAINT `followers_namelist_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `user_creativeinfo` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `fans_namelist` (
  `fans_id` int(10) NOT NULL,
  `user_id` int(10) NOT NULL COMMENT '外键',
  PRIMARY KEY (`fans_id`),
  KEY `user_id` (`user_id`),
  CONSTRAINT `fans_namelist_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `user_creativeinfo` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


INSERT INTO `user_info` VALUES(001, 'LiMing', '123456', '男', 'example@qq.com', '1999-01-01', '173****0612', '32', bin(0101));

INSERT INTO `creative_capsule` VALUES(001, '想法', 001, '我有一个大胆的想法', '2019-10-14', '2019-10-15');

INSERT INTO `bbs_topic` VALUES(001, 001, '人不可以，至少不应该', 001, '快停下你们的想法', '2019-10-15', 1, 10);

INSERT INTO `bbs_achievement` VALUES(001, 001, '内容内容内容', 001, 10, 2, '2019-10-14', 1);

INSERT INTO `bbs_comment` VALUES(001, 001, 'wwww', '2019-10-14', 1, 1, 001, 001);

INSERT INTO `bbs_reply` VALUES(001, 001, '我有一个大胆的想法', 1, 001, 001);







